{"version":3,"sources":["codemirror.js","bread.js","index.js"],"names":["DiffMatchPatch","require","dmp","global","JsDiff","CodeEditor","_this","this","el","ReactDOM","findDOMNode","querySelector","state","props","cm","CodeMirror","value","data","mode","matchBrackets","lineNumbers","keyMap","autoCloseBrackets","lineWrapping","undoDepth","viewportMargin","Infinity","tabSize","indentUnit","indentWithTabs","extraKeys","Cmd-Enter","CmdEnter","log","match","exec","Error","stack","line","parseInt","thing","document","createElement","className","innerText","JSON","stringify","mark","setBookmark","ch","widget","insertLeft","__lineText","getLine","__result","getAllMarks","filter","k","forEach","clear","eval","getValue","Cmd-Z","requestAnimationFrame","undo","Shift-Cmd-Z","redo","Cmd-K","fork","Cmd-S","save","Cmd-M","setMessage","on","origin","commit","text","trim","find","updateDiff","focus","__diff","lineWidgets","eachLine","removeLineClass","compare","changes","diff_main","diff_cleanupSemantic","choffset","j","length","_changes$j","Object","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","type","posFromIndex","markText","curOp","selections","getSelections","setValue","setSelections","err","react__WEBPACK_IMPORTED_MODULE_6___default","a","React","Component","reduce","prev","delta","version","sqr","x","dist2","v","w","y","distToSegment","p","Math","sqrt","l2","t","max","min","distToSegmentSquared","uuid","random","toString","slice","Bread","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","dragThing","mouseMove","bind","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__","mouseUp","e","setState","window","addEventListener","preventDefault","clientY","thingRect","rows","querySelectorAll","lines","i","rect","getBoundingClientRect","push","x0","left","x1","right","y0","top","y1","pos","bottom","slices","dist","clientX","closestPos","sort","b","split","join","dockTarget","layout","map","row","id","elements","nextRows","cloneLayout","oldThing","splice","newRow","updateLayout","removeEventListener","_this2","Slice","style","cursor","react_flip_move__WEBPACK_IMPORTED_MODULE_9__","rowi","key","react_addons_css_transition_group__WEBPACK_IMPORTED_MODULE_8___default","transitionName","transitionEnterTimeout","transitionLeaveTimeout","coli","assign","view","isDragging","getView","result","newRows","update","close","beginDrag","onClick","concat","getState","store","parent","getPath","childStore","childMapping","getChildren","computeAnchor","children","node","textNode","createElementNS","svg","DAG","messages","v_spacing","v_height","h_spacing","path","anchor","height","recursive","trail","rect_width","label","textContent","getComputedTextLength","rx","ry","width","includes","pointer","setPointer","metaKey","altKey","shiftKey","ctrlKey","trailIndex","indexOf","cx","cy","r","child","d","curvedHorizontal","x2","y2","mx","title","pathIndex","chunk","views","getCurrentChunk","updatePointer","shouldFork","applyUpdate","viewIndex","onMouseDown","hideFooter","ref","placeholder","onChange","target","onKeyDown","keyCode","toggleFocus","aria-hidden","disabled","_codemirror_js__WEBPACK_IMPORTED_MODULE_11__","Date","now","appendStore","date","setAttribute","setAttributeNS","body","appendChild","DEFAULT_STATE","null","App","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","parse","localStorage","console","confirm","_bread_js__WEBPACK_IMPORTED_MODULE_10__","_Users_kevin_Dropbox_Projects_derp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","message","render","getElementById"],"mappings":"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","file":"static/js/main.98215cf4.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\n\n\nimport CodeMirror from 'codemirror';\nimport 'codemirror/mode/javascript/javascript'\nimport 'codemirror/lib/codemirror.css'\nimport 'codemirror/keymap/sublime'\n\nimport \"codemirror/addon/edit/closebrackets\"\nimport 'codemirror/addon/edit/matchbrackets'\nimport \"codemirror/addon/comment/comment\"\nimport \"./codemirror.css\"\n\nvar DiffMatchPatch = require('diff-match-patch');\nvar dmp = new DiffMatchPatch();\nglobal.dmp = dmp\n\nvar JsDiff = require('diff');\n\n\nexport default class CodeEditor extends React.Component {\n    componentDidMount(){\n        var el = ReactDOM.findDOMNode(this).querySelector('.editor');\n\n        var state = this.props.state;\n\n\n        var cm = CodeMirror(el, {\n            value: this.props.state.data,\n            mode: 'plain',\n\n            matchBrackets: true,\n            lineNumbers: false,\n            keyMap: 'sublime',\n            autoCloseBrackets: true,\n            lineWrapping: true,\n            undoDepth: 0,\n            viewportMargin: Infinity,\n            \n            tabSize: 4,\n            indentUnit: 4,\n            indentWithTabs: false,\n\n            extraKeys: {\n                \"Cmd-Enter\"(cm){\n                    cm.getAllMarks()\n                        .filter(k => k.__result)\n                        .forEach(k => k.clear());\n\n                    function log(value){\n                        var match = /\\<anonymous\\>:(\\d+)/.exec((new Error()).stack);\n                        if(match){\n                            var line = parseInt(match[1], 10)\n                            var thing = document.createElement('span')\n                            thing.className = 'result'\n                            thing.innerText = JSON.stringify(value)\n                            var mark = cm.setBookmark({ line: line - 1, ch: 1e8 }, {\n                                widget: thing,\n                                insertLeft: true\n                            })\n                            mark.__lineText = cm.getLine(line - 1)\n                            mark.__result = true;\n                        }\n                    }\n                    eval(cm.getValue())\n                },\n                \"Cmd-Z\": (cm) => requestAnimationFrame(k => this.props.undo()),\n                \"Shift-Cmd-Z\": (cm) => requestAnimationFrame(k => this.props.redo()),\n                \"Cmd-K\": (cm) => requestAnimationFrame(k => this.props.fork()),\n                \"Cmd-S\": (cm) => requestAnimationFrame(k => this.props.save()),\n                \"Cmd-M\": (cm) => {\n                    this.props.setMessage()\n                }\n            }\n        })\n        this.cm = cm;\n        \n        cm.on('change', (cm, ch) => {\n            if(ch.origin !== 'setValue' && cm.getValue() !== this.props.state.data){\n                // this.props.onChange(cm.getValue())\n                this.props.commit({ text: cm.getValue() })\n            }\n            cm.getAllMarks()\n                .filter(k => k.__result && k.__lineText.trim() !== cm.getLine(k.find().line).trim())\n                .forEach(k => k.clear());\n            // console.log(cm.getValue(), ch)\n            // this.props.onChange(cm.getValue())\n        })\n        this.updateDiff()\n    }\n    focus(){\n        this.cm.focus()\n    }\n    updateDiff(){\n\n        var cm = this.cm;\n        cm.getAllMarks()\n            .filter(k => k.__diff)\n            .forEach(k => k.clear());\n        if(cm.lineWidgets) cm.lineWidgets.forEach(k => k.clear());\n        cm.lineWidgets = []\n        cm.eachLine(line => {\n            cm.removeLineClass(line, 'background', 'line-inserted')\n            cm.removeLineClass(line, 'background', 'line-changed')\n        })\n\n        if(typeof this.props.compare === 'string'){\n\n            var changes = dmp.diff_main(this.props.compare, this.props.state.data);\n            dmp.diff_cleanupSemantic(changes)\n            var choffset = 0;\n            for(var j = 0; j < changes.length; j++){\n                let [type, text] = changes[j];\n                if(type < 0){ // delete\n                    let thing = document.createElement('span')\n                    thing.className = 'deleted'\n                    thing.innerText = text;\n                    let mark = cm.setBookmark(cm.posFromIndex(choffset), {\n                        widget: thing\n                    })\n                    mark.__diff = true;\n                }else if(type > 0){ // insert\n                    let mark = cm.markText(cm.posFromIndex(choffset), cm.posFromIndex(choffset + text.length), {\n                        className: 'inserted'\n                    })\n                    mark.__diff = true;\n\n                    choffset += text.length;\n                    \n                }else{\n                    choffset += text.length;\n                }\n            }\n\n        }\n    }\n    componentDidUpdate(){\n        if(!this.cm.curOp && this.props.state.data !== this.cm.getValue()){\n            var selections = this.cm.getSelections()\n            this.cm.setValue(this.props.state.data)\n            try {\n                this.cm.setSelections(selections)\n            } catch (err) {}\n        }\n        this.updateDiff()\n    }\n    render(){ \n        return <div className=\"widget\">\n            <div className=\"editor\" />\n        </div> \n    }\n}\n\n\nexport function reduce(prev, delta){\n    if(!prev) return { version: 0, data: '' };\n\n    return {\n        version: prev.version + 1,\n        data: delta.text\n    }\n}\n\n// export default function Widget(props){\n//     var state = props.state;\n//     if(!state){\n//         return <div>(no state)</div>\n//     }\n//     return <div className=\"widget\">\n//             <CodeEditor \n//                 value={state.data}\n                \n//                 undo={props.undo} \n//                 redo={props.redo}\n//                 fork={props.fork}\n//                 setMessage={props.setMessage}\n//                 save={props.save}\n\n//                 compare={props.compare && props.compare.data}\n//                 onChange={text => props.commit({ text: text })} />\n//     </div>\n// }","// why did i name this bread\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport ReactCSSTransitionGroup from 'react-addons-css-transition-group' // ES6\nimport FlipMove from 'react-flip-move';\n\nimport './bread.css';\nimport 'font-awesome/css/font-awesome.css';\n\n\n\nfunction sqr(x) { return x * x }\nfunction dist2(v, w) { return sqr(v.x - w.x) + sqr(v.y - w.y) }\nfunction distToSegmentSquared(p, v, w) {\n  var l2 = dist2(v, w);\n  if (l2 == 0) return dist2(p, v);\n  var t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\n  t = Math.max(0, Math.min(1, t));\n  return dist2(p, { x: v.x + t * (w.x - v.x),\n                    y: v.y + t * (w.y - v.y) });\n}\nfunction distToSegment(p, v, w) { return Math.sqrt(distToSegmentSquared(p, v, w)); }\n\nfunction uuid(){\n\treturn Math.random().toString(36).slice(5, 10)\n}\n\n\nexport default class Bread extends React.Component {\n\tconstructor(){\n\t\tsuper()\n\t\tthis.state = { dragThing: null }\n\t\tthis.mouseMove = this.mouseMove.bind(this)\n\t\tthis.mouseUp = this.mouseUp.bind(this)\n\t}\n\tbeginDrag(thing, e){\n\t\t// console.log('begin drag', thing, e)\n\t\tthis.setState({\n\t\t\tdragThing: thing\n\t\t})\n\t\twindow.addEventListener('mousemove', this.mouseMove)\n\t\twindow.addEventListener('mouseup', this.mouseUp)\n\t}\n\tmouseMove(e){\n\t\tif(this.state.dragThing){\n\t\t\te.preventDefault()\n\t\t}\n\t\tvar clientY = e.clientY;\n\t\tvar el = ReactDOM.findDOMNode(this);\n\t\tvar rows = el.querySelectorAll('.row');\n\t\tvar thingRect;\n\n\t\tvar lines = []\n\t\tfor(var i = 0; i < rows.length; i++){\n\t\t\tvar rect = rows[i].getBoundingClientRect()\n\t\t\tif(i === 0){\n\t\t\t\tlines.push({\n\t\t\t\t\tx0: rect.left, x1: rect.right,\n\t\t\t\t\ty0: rect.top, y1: rect.top,\n\t\t\t\t\tpos: 'top-' + i\n\t\t\t\t})\n\t\t\t}\n\t\t\tlines.push({\n\t\t\t\tx0: rect.left, x1: rect.right,\n\t\t\t\ty0: rect.bottom, y1: rect.bottom,\n\t\t\t\tpos: 'bottom-' + i\n\t\t\t})\n\n\t\t\tvar slices = rows[i].querySelectorAll('.slice');\n\t\t\tfor(var j = 0; j < slices.length; j++){\n\t\t\t\tvar rect = slices[j].getBoundingClientRect()\n\t\t\t\tif(j === 0){\n\t\t\t\t\tlines.push({\n\t\t\t\t\t\tx0: rect.left, x1: rect.left,\n\t\t\t\t\t\ty0: rect.top, y1: rect.bottom,\n\t\t\t\t\t\tpos: 'left-' + i + '-' + j\n\t\t\t\t\t})\t\n\t\t\t\t}\n\t\t\t\tlines.push({\n\t\t\t\t\tx0: rect.right, x1: rect.right,\n\t\t\t\t\ty0: rect.top, y1: rect.bottom,\n\t\t\t\t\tpos: 'right-' + i + '-' + j\n\t\t\t\t})\n\n\t\t\t\tif(this.state.dragThing == i + '-' + j){\n\t\t\t\t\tthingRect = rect;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t\n\n\n\t\tlines.forEach(k => {\n\t\t\tk.dist = distToSegment(\n\t\t\t\t{ x: e.clientX, y: e.clientY }, \n\t\t\t\t{ x: k.x0, y: k.y0 }, \n\t\t\t\t{ x: k.x1, y: k.y1 })\n\t\t})\n\n\t\tvar closestPos = lines.sort((a, b) => a.dist - b.dist)[0].pos\n\t\tvar thing = this.state.dragThing.split('-');\n\n\t\tif(e.clientX > thingRect.left && e.clientX < thingRect.right\n\t\t\t&& e.clientY > thingRect.top && e.clientY < thingRect.bottom){\n\n\t\t\tclosestPos = (+thing[1] == 0) ? \n\t\t\t\t('left-' + thing.join('-')) : \n\t\t\t\t('right-' + [thing[0], thing[1] - 1].join('-'))\n\t\t}\n\t\t// console.log(closestPos.pos)\n\n\n\t\t// console.log(i)\n\t\tif(this.state.dockTarget !== i){\n\t\t\tthis.setState({\n\t\t\t\tdockTarget: closestPos\n\t\t\t})\t\n\t\t}\n\t\t\n\t\t// console.log('moving', e, )\n\t}\n\tcloneLayout(){\n\t\treturn {\n\t\t\trows: this.props.layout.rows.map(row => {\n\t\t\t\treturn { id: row.id, elements: row.elements.slice(0) }\n\t\t\t})\n\t\t}\n\t}\n\tmouseUp(e){\n\t\t\n\t\tif(this.state.dockTarget){\n\t\t\tvar pos = this.state.dockTarget.split('-');\n\t\t\tvar thing = this.state.dragThing.split('-');\n\n\t\t\tvar nextRows = this.cloneLayout().rows;\n\t\t\t\n\n\t\t\tif(pos[0] === 'top' || pos[0] === 'bottom'){\n\t\t\t\tif((nextRows[+thing[0]].elements.length == 1) &&\n\t\t\t\t\t((pos[0] === 'top'  && +thing[0] === +pos[1]) || \n\t\t\t\t\t(pos[0] === 'bottom' && +thing[0] === parseInt(pos[1])+1) ||\n\t\t\t\t\t(pos[0] === 'bottom' && +thing[0] === +pos[1]) )\n\t\t\t\t){\n\t\t\t\t}else{\n\t\t\t\t\tvar oldThing = nextRows[+thing[0]].elements.splice(+thing[1], 1)[0];\n\t\t\t\t\tvar newRow = { id: uuid(), elements: [ oldThing ] }\n\t\t\t\t\tif(pos[0] === 'top'){\n\t\t\t\t\t\tnextRows.splice(+pos[1], 0, newRow)\n\t\t\t\t\t}else{\n\t\t\t\t\t\tnextRows.splice(1 + parseInt(pos[1]), 0, newRow)\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t}else if(pos[0] === 'left' || pos[0] === 'right'){\n\t\t\t\t// swap it with null\n\t\t\t\tvar oldThing = nextRows[+thing[0]].elements.splice(+thing[1], 1, null)[0];\n\n\t\t\t\tif(pos[0] === 'left'){\n\t\t\t\t\tnextRows[+pos[1]].elements.splice(+pos[2], 0, oldThing)\n\t\t\t\t}else{\n\t\t\t\t\tnextRows[+pos[1]].elements.splice(1 +parseInt(pos[2]), 0, oldThing)\n\t\t\t\t}\n\t\t\t\t// actually remove the thing\n\t\t\t\tnextRows[+thing[0]].elements = nextRows[+thing[0]].elements.filter(k => k !== null)\n\n\t\t\t}\n\n\t\t\tnextRows = nextRows.filter(k => k.elements.length > 0)\n\n\t\t\tthis.props.updateLayout({ rows: nextRows })\n\t\t}\n\n\n\n\t\tthis.setState({\n\t\t\tdragThing: null,\n\t\t\tdockTarget: null\n\t\t})\n\n\t\twindow.removeEventListener('mousemove', this.mouseMove)\n\t\twindow.removeEventListener('mouseup', this.mouseUp)\n\t}\n\n\trender(){\n\t\tvar Slice = this.props.Slice;\n\t\treturn <div className=\"bread\" style={{ cursor: this.state.dragThing ? 'move' : 'default' }}>\n\t\t<FlipMove>\n\t\t{this.props.layout.rows.map((row, rowi) => \n\t\t\t<div className={\"row \" + (\n\t\t\t\t(this.state.dockTarget === ('top-' + rowi) ? 'insert-top ' : '') +\n\t\t\t\t(this.state.dockTarget === ('bottom-' + rowi) ? 'insert-bottom ' : '') +\n\t\t\t\t('row-' + row.elements.length + ' ')\n\t\t\t)} key={row.id}>\n\t\t\t<ReactCSSTransitionGroup\n\t          transitionName=\"example\"\n\t          transitionEnterTimeout={300}\n\t          transitionLeaveTimeout={300}>\n\n\t\t\t{row.elements.map((data, coli) => \n\t\t\t\t<div className={\"col \" + (\n\t\t\t\t\t(this.state.dockTarget === ('left-' + rowi + '-' + coli) ? 'insert-left ' : '') +\n\t\t\t\t\t(this.state.dockTarget === ('right-' + rowi + '-' + coli) ? 'insert-right ' : '')\n\t\t\t\t)} key={data.id}>\n\t\t\t\t\t<Slice view={data} \n\t\t\t\t\tisDragging={this.state.dragThing === [rowi, coli].join('-')}\n\t\t\t\t\tgetView={id => {\n\t\t\t\t\t\tvar result;\n\t\t\t\t\t\tthis.props.layout.rows.forEach(row => row.elements.forEach(data => {\n\t\t\t\t\t\t\tif(data.id == id) result = data;\n\t\t\t\t\t\t}))\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}}\n\t\t\t\t\tfork={e => {\n\t\t\t\t\t\tvar newRows = this.cloneLayout().rows;\n\t\t\t\t\t\tnewRows[rowi].elements.splice(coli + 1, 0, Object.assign({}, data, { id: uuid() }, e || {}) )\n\t\t\t\t\t\tthis.props.updateLayout({ rows: newRows })\n\t\t\t\t\t}}\n\t\t\t\t\tupdate={e => {\n\t\t\t\t\t\tvar newRows = this.cloneLayout().rows;\n\t\t\t\t\t\tnewRows[rowi].elements[coli] = Object.assign({}, data, e)\n\t\t\t\t\t\tthis.props.updateLayout({ rows: newRows })\n\t\t\t\t\t}}\n\t\t\t\t\tclose={e => {\n\t\t\t\t\t\tvar newRows = this.cloneLayout().rows;\n\t\t\t\t\t\tnewRows[rowi].elements.splice(coli, 1)\n\t\t\t\t\t\tthis.props.updateLayout({ rows: newRows.filter(k => k.elements.length > 0) })\n\t\t\t\t\t}}\n\t\t\t\t\tbeginDrag={\n\t\t\t\t\t\te => this.beginDrag([rowi, coli].join('-'), e)\n\t\t\t\t\t} \n\t\t\t\t\t{...this.props} />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t</ReactCSSTransitionGroup>\n\t\t\t</div>\n\t\t)}\n\n\t\t<div className=\"fake-row row-1\" onClick={e => \n\t\t\tthis.props.updateLayout({ rows: \n\t\t\t\tthis.props.layout.rows.concat([{ id: uuid(), elements: [{ id: uuid() }] }])\n\t\t\t})}>\n\t\t\t<span>\n\t\t\t\t<div className=\"col\">\n\t\t\t\t\t<div className=\"fake-slice\">+</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t</div>\n\n\t\t</FlipMove>\n\t\t</div>\n\t}\n}\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport \"./app.css\"\nimport \"./dag.css\"\nimport Bread from './bread.js'\nimport Widget, { reduce } from './codemirror.js'\n\n\nfunction getState(store, id){\n    var commit = store[id];\n    if(!commit) return reduce(null, null);\n    return reduce(getState(store, commit.parent), commit.delta);\n}\n\nfunction getPath(store, id){\n    var commit = store[id];\n    if(!commit) return [null];\n    return getPath(store, commit.parent).concat([id])\n}\n\n\nvar childStore = null,\n    childMapping = {};\n\nfunction getChildren(store, id){\n    // return Object.keys(store).filter(k => store[k].parent === id);\n\n    if(store !== childStore){\n        childStore = store;\n        childMapping = {}\n        for(var k in store){\n            var parent = store[k].parent;\n            if(!childMapping[parent]){\n                childMapping[parent] = [k];\n            }else{\n                childMapping[parent].push(k)\n            }\n        }\n    }\n    return childMapping[id] || [];\n}\n\n\nfunction computeAnchor(store, id){\n    var children = getChildren.bind(this, store)\n    var node = id;\n    var ch = children(node);\n    while(ch.length > 0){\n        node = ch[0]\n        ch = children(node)\n    }\n    return node;\n}\n\nfunction getCurrentChunk(store, id, views, messages){\n    var children = getChildren.bind(this, store)\n    var node = id;\n    var ch = children(node);\n\n    while(ch.length === 1 \n        && node \n        // && !views.some(k => k.anchor == node)\n        && !(messages[node])\n        ){\n        node = ch[0]\n        // trail.push(node)\n        ch = children(node)\n    }\n    return node;\n}\n\n\n\nvar textNode = document.createElementNS(\"http://www.w3.org/2000/svg\",\"text\");\nvar svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\nsvg.setAttribute('class', 'measure')\nsvg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\ndocument.body.appendChild(svg);\nsvg.appendChild(textNode)\n\nfunction measureText(text){\n    if(!text.trim()) return 0;\n    textNode.textContent = text;\n    return textNode.getComputedTextLength();\n}\n\n\nexport default function DAG(props){\n    var store = props.store,\n        view = props.view,\n        messages = props.messages;\n\n    const v_spacing = 25;\n    const v_height = 20;\n\n    const h_spacing = 10;\n\n    var children = getChildren.bind(this, store)\n    var path = getPath(store, view.anchor);\n\n    var elements = [],\n        lines = [];\n\n    function recursive(node, x, y){\n        var ch = children(node);\n        var trail = [node]\n        while(ch.length === 1 \n            && node \n            && !(props.messages[node])\n        ){\n            node = ch[0]\n            trail.push(node)\n            ch = children(node)\n        }\n\n        if(!node){\n\n        }else{\n            // console.log(trail.includes(view.pointer))\n            var rect_width = 10 * Math.sqrt(trail.length + 1)\n\n            var label = messages[node] || '';\n\n            rect_width = Math.max(rect_width, 5 + measureText(label))\n        \n            elements.push(<rect \n                key={'r-' + node}\n                x={x} y={y - v_height/2} \n                rx={2} ry={2}\n                width={rect_width} height={v_height} className={trail.includes(view.pointer) ? 'active' : (\n                    path.includes(node) ? 'mainline' : 'inactive') }\n                onClick={e => props.setPointer(node, e.metaKey || e.altKey || e.shiftKey || e.ctrlKey)}/>);\n\n            if(trail.includes(view.pointer) && trail.length > 0){\n                var trailIndex = trail.indexOf(view.pointer),\n                    eps = 0.001;\n                elements.push(<circle \n                    key={'c-' + node}\n                    cx={x + rect_width * ((trailIndex + eps) / (trail.length - 1 + eps) )} \n                    cy={y} r={3} className=\"active\" />)\n            }\n\n            elements.push(<text key={'t-'+node} x={2+x} y={y}>{label}</text>)\n\n            x += rect_width;\n        }\n\n        var y1 = y;\n        for(var i = 0; i < ch.length; i++){\n            var child = ch[i]\n            if(i > 0) y1 += v_spacing;\n\n            // if(node) lines.push(<line \n            //     x1={x} y1={y} \n            //     x2={x + h_spacing} y2={y1}\n            //     className={path.includes(child) ? 'mainline' : 'inactive'} />)\n\n            if(node) lines.push(<path \n                key={'p-' + child}\n                d={curvedHorizontal(x,y,x + h_spacing,y1)}\n                className={path.includes(child) ? 'mainline' : 'inactive'} />)\n            y1 = recursive(child, x + h_spacing, y1);\n            \n        }\n        return y1;\n    }\n\n    var height = 10 + recursive(null, -h_spacing, 10);\n    return <svg className=\"dag\" height={height}>{lines}{elements}</svg>\n}\n\n\n// https://github.com/hughsk/svg-line-curved/blob/master/index.js\nfunction curvedHorizontal(x1, y1, x2, y2) {\n    var line = []\n    var mx = x1 + (x2 - x1) / 2\n\n    line.push('M', x1, y1)\n    line.push('C', mx, y1, mx, y2, x2, y2)\n\n    return line.join(' ')\n}\n\n\nfunction Slice(props){\n    var pointer = props.view.pointer || null,\n        anchor = props.view.anchor || null;\n\n    var state = getState(props.store, pointer);\n    var path = getPath(props.store, anchor);\n    var pathIndex = path.indexOf(pointer);\n    var chunk = getCurrentChunk(props.store, pointer, props.views, props.messages);\n\n    var updatePointer = (id, shouldFork) => {\n        // if(shouldFork){\n        //     console.log('update pointer', id, shouldFork)\n        //     props.fork({\n\n        //     })\n        //     return\n        // }\n\n        const applyUpdate = e => shouldFork ? props.fork(e) : props.update(e);\n\n        if(path.includes(id)){\n            applyUpdate({ pointer: id })    \n        }else{\n            // TODO: find a suitable end-of-line for anchor\n            applyUpdate({ pointer: id, anchor: computeAnchor(props.store, id) })\n        }\n    }\n\n    var commit = (delta) => {\n        var id = 'C' + Date.now();\n        props.appendStore(id, { \n            parent: pointer, \n            delta: delta,\n            date: Date.now()\n        })\n        updatePointer(id)\n    }\n\n    var fork = () => {\n        props.fork()\n        // if(!props.messages[props.view.pointer]){\n        //     props.setMessage(props.view.pointer, 'r' + pathIndex)\n        // }\n    }\n\n    var save = () => {\n        if(!props.messages[props.view.pointer]){\n            props.setMessage(props.view.pointer, 'r' + pathIndex)\n        }\n    }\n\n    /*\n    <div className=\"body\">\n        <pre>{JSON.stringify(props.view)}</pre>\n        <pre>{JSON.stringify(state)}</pre>\n\n        <textarea \n            value={state.data} \n            onChange={e => commit({ text: e.target.value }) } />\n    </div>\n\n\n    */\n\n    var compare;\n    if(props.viewIndex){\n        compare = getState(props.store, props.getView(props.viewIndex).pointer || null)\n    }\n\n    let title;\n    let widget;\n\n    return <div className={\"slice \" + (props.isDragging ? 'dragging ' : '') + (props.viewIndex == props.view.id ? 'reference ' : '')}>\n        <div className=\"header\" onMouseDown={props.beginDrag}>\n            <div className={\"button-toggle \" + (props.view.hideFooter?'inactive':'active')} \n                title=\"Toggle revision timeline\"\n                onClick={e => props.update({ hideFooter: !props.view.hideFooter })}>\n                {props.view.hideFooter ? \"▼\" : '▲'}</div>\n\n            <input \n                type=\"text\" \n                ref={e => title = e}\n                className=\"title\" value={props.messages[chunk] || ''} \n                placeholder=\"no description\" \n                onChange={e => props.setMessage(chunk, e.target.value) } \n                onKeyDown={e => {\n                    if(e.keyCode === 13){\n                        e.preventDefault()\n                        widget.focus()\n                    }\n                }}/>\n\n            \n            <div className={\"button \" + (props.viewIndex == props.view.id ? 'active' : 'inactive')} \n                onClick={e => props.toggleFocus(props.view.id)}\n                title=\"Show differences relative to this version.\">\n                <i className=\"fa fa-bullseye\" aria-hidden=\"true\" /></div>\n\n            \n\n            <div className=\"button\" onClick={fork}\n                title=\"Fork this revision\">\n                <i className=\"fa fa-code-fork\" aria-hidden=\"true\" /></div>\n\n            <div className=\"button\" onClick={props.close}\n                title=\"Close this window\">\n                <i className=\"fa fa-close\" aria-hidden=\"true\" /></div>\n\n\n        \n        </div>\n\n        {props.view.hideFooter ? null : <div className=\"footer\"> \n            <input type=\"range\" className=\"time-slider\" min={0} max={path.length - 1} \n                disabled={path.length < 2}\n                onChange={e => updatePointer(path[e.target.value])}\n                value={path.indexOf(pointer)} />\n\n            <DAG \n                store={props.store} \n                view={props.view} \n                messages={props.messages}\n                views={props.views}\n                setPointer={updatePointer} />\n        </div>}\n        \n        <Widget\n            ref={e => widget = e}\n            setMessage={e => title.focus()}\n            undo={e => (pathIndex > 0) && updatePointer(path[pathIndex - 1])}\n            redo={e => (pathIndex < path.length - 1) && updatePointer(path[pathIndex + 1])}\n            fork={e => fork()}\n            save={e => save()}\n\n            compare={compare}\n            state={state} \n            commit={commit} />\n        \n    </div>\n}\n\n\nconst DEFAULT_STATE = {\n    store: {\n    },\n    messages: {\n        null: ''\n    },\n    layout: {\n        rows: []\n    }\n}\n\nclass App extends React.Component {\n    constructor(){\n        super()\n        try {\n            this.state = JSON.parse(localStorage.state)\n            console.log(this.state.layout.rows.length);\n        }catch(e){\n            this.state = JSON.parse(JSON.stringify(DEFAULT_STATE))\n        }\n        // window.onstorage = () => {\n        //     var latest = JSON.parse(localStorage.state);\n        //     if(JSON.stringify(latest.store) != JSON.stringify(this.state.store) ||\n        //         JSON.stringify(latest.messages) != JSON.stringify(this.state.messages)){\n        //         this.setState({ store: latest.store, messages: latest.messages })    \n        //     }\n        // }\n    }\n    componentDidUpdate(){\n        localStorage.state = JSON.stringify(this.state)\n    }\n\n    render(){\n        global.App = this;\n\n        return <div>\n            <div className=\"main-header\">\n                <h1>derp version control prototype</h1>\n\n                <div className=\"toolbar\">\n                    <div className=\"button\" onClick={e => {\n                        if(window.confirm('Are you sure you want to clear all history and start over? This can not be undone.')){\n                            localStorage.state = null\n                            this.setState(JSON.parse(JSON.stringify(DEFAULT_STATE)));    \n                        }\n                    }} title=\"Clear everything\">\n                        <i className=\"fa fa-trash\" aria-hidden=\"true\"></i></div>\n                </div>\n            </div>\n            <div className=\"main-header\">\n            <div>\n                <p>\n                \n                <b>Derp</b> is <b>version control</b> reimagined for <b>experimentation</b> and <b>live collaboration</b> in the internet age.\n                </p>\n                <p>\n\n                Rather than operating on files, it’s integrated into an application's state management system. \n\n                Coupled with a projectional window management system, you can create <b>lightweight forks</b> to try new ideas while referencing other versions. \n\n                Edits are synchronized character-by-character over the internet in <b>real-time</b>. \n\n                It blends the simplicity of <b>undo/redo</b> with the power and reliability of modern distributed version control systems like Git.\n\n                You never have to worry about losing data by a series of undos, redos, and edits. And you never have to worry about forgetting to commit code. \n\n                </p>\n                </div>\n            </div>\n            <Bread \n                Slice={Slice} \n                \n                layout={this.state.layout}\n                updateLayout={data => this.setState({ layout: data })}\n\n                store={this.state.store}\n                messages={this.state.messages}\n                viewIndex={this.state.viewIndex}\n\n                toggleFocus={id => this.setState({ viewIndex: this.state.viewIndex == id ? null : id })}\n                appendStore={(id, value) => this.setState({ store: \n                            Object.assign({}, this.state.store, { [id]: value }) })}\n                setMessage={(id, message) => this.setState({ messages: \n                            Object.assign({}, this.state.messages, { [id]: message })})} />\n        </div>    \n    }\n}\n\n\nReactDOM.render(\n    <App />,\n    document.getElementById('root')\n);\n"],"sourceRoot":""}